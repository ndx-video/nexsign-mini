<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nexSign mini Dashboard</title>
    <script type="module" src="/static/datastar.js"></script>
    <!-- Tailwind CSS standalone build -->
    <script src="/static/tailwind.js"></script>
    <!-- Application JavaScript -->
    <script src="/static/app.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        desert: {
                            bg: '#333333',
                            fg: '#ffffff',
                            tan: '#cfbfad',
                            yellow: '#ffd700',
                            orange: '#ffa500',
                            red: '#cd5c5c',
                            green: '#98fb98',
                            cyan: '#87ceeb',
                            gray: '#808080',
                            darkgray: '#4d4d4d',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Minimal custom styles kept for iframe sizing */
        html,
        body {
            height: 100%;
        }

        iframe {
            border: none;
            width: 100%;
            height: 100%;
            background-color: #333;
        }

        a {
            cursor: pointer;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col bg-desert-bg text-desert-tan">

    <nav class="w-full bg-desert-darkgray border-b border-desert-gray h-14 px-4 flex items-center justify-evenly">
        <div class="breadcrumbs text-sm text-desert-yellow py-2 cursor-pointer align-items-start">
            <a class="p-2 hover:text-desert-orange" data-on-click="@get('/views/home')" onclick="onViewLoad('home')">Home</a> /
            <a class="p-2 hover:text-desert-orange" data-on-click="@get('/views/advanced')">Advanced</a> /
            <a class="p-2 hover:text-desert-orange" data-on-click="@get('/views/api')" onclick="onViewLoad('api')">API</a>
        </div>
    <!-- Universal status bar for realtime messages -->
        <div id="status-bar" class="flex items-center gap-3 px-4 py-2">
            <div class="text-xs text-center space-y-0.5 leading-tight">
                <div id="status-msg-0" class="text-white"></div>
                <div id="status-msg-1" class="text-desert-tan/60"></div>
                <div id="status-msg-2" class="text-desert-gray/40"></div>
            </div>
        </div>
        <div class="text-xs text-desert-gray select-none">nexSign mini 
            <span class="text-xs font-normal text-desert-gray">v{{.CurrentVersion}}</span>
            <span class="text-desert-gray/60">(build-ts: {{.BuildTime}})</span>
        </div>
    </nav>


    <!-- This is the main content area that Datastar will update -->
    <div id="content-area" class="flex-1 p-4" data-on-load="@get('/views/home')">
        <!-- Initial content (like a loading spinner) could go here -->
    </div>

    <script>
        // Status bar message management
        const statusMessages = ['', '', ''];
        
        function updateStatusBar(message) {
            if (!message) return;
            
            // Shift messages down
            statusMessages.unshift(message);
            statusMessages.pop();
            
            // Update DOM
            document.getElementById('status-msg-0').textContent = statusMessages[0];
            document.getElementById('status-msg-1').textContent = statusMessages[1];
            document.getElementById('status-msg-2').textContent = statusMessages[2];
        }

        // Connect to status messages WebSocket
        function connectStatusWS() {
            const proto = (location.protocol === 'https:') ? 'wss' : 'ws';
            const ws = new WebSocket(proto + '://' + location.host + '/ws/status');
            
            ws.onopen = () => {
                updateStatusBar('Connected to status updates');
            };
            
            ws.onmessage = (ev) => {
                try {
                    const msg = JSON.parse(ev.data);
                    if (msg.text) {
                        updateStatusBar(msg.text);
                    }
                } catch(e) {
                    console.error('Failed to parse status message:', e);
                }
            };
            
            ws.onclose = () => {
                updateStatusBar('Disconnected from status updates. Reconnecting...');
                setTimeout(connectStatusWS, 2000);
            };
            
            ws.onerror = () => {
                try { ws.close(); } catch(e) {}
            };
        }
        
        // Start status WebSocket connection
        connectStatusWS();
    </script>

</body>

</html>